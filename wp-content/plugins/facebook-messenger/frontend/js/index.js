jQuery(document).ready(function(){function e(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}function t(e){navigator.vibrate&&navigator.vibrate(e||50)}function r(e,t){var r=d;e=e||m,t=t||b,r.style.transform=r.style.webkitTransform=r.style.MozTransform="translate("+Math.round(e,10)+"px, "+Math.round(t,10)+"px)"}function n(){window.requestAnimationFrame(n),r()}function a(e,t){var r=jQuery("body").width()/2,n=jQuery("body").height(),a=e>r?(e-r)/r:-(r-e)/r,i=Math.min(1,(n-t)/(n/2));p.style.marginLeft=Math.round(12*a)+"px",p.style.marginBottom=Math.round(12*i)+"px"}function i(){if(jQuery(".drag-wrapper .thing").hasClass("showContent"))return!1;var e=F[F.length-1];return{x:e.velocityX,y:e.velocityY}}function o(){jQuery("body").removeClass("touching")}function s(){jQuery("body").addClass("touching")}function g(){jQuery("body").addClass("moving")}function u(){jQuery("body").removeClass("moving"),p.style.marginBottom=p.style.marginLeft="0px"}function h(e){var t=jQuery(window).width()/2;m=m<t?5:2*t-60,b<0&&(b=20)}if(void 0===l)var l="center";if(void 0===w)var w=10;navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;var d=document.querySelector("[data-drag]"),p=document.querySelector(".magnet-zone");n(),jQuery(window).on("resize",function(){jQuery(".drag-wrapper .thing").hasClass("showContent")||(b=jQuery(window).height()/2-jQuery(".drag-wrapper .thing").outerHeight()/2,x=b)}),e()&&jQuery(".drag-wrapper").append('<div class="drag-overlay"></div>'),e()?jQuery(".drag-wrapper").on("click",".drag-overlay",function(e){!jQuery(e.target).hasClass("facebook-messenger-avatar")&&jQuery(".drag-wrapper .thing .content:visible").length&&(jQuery(".drag-wrapper .thing").removeClass("showContent"),jQuery(".drag-wrapper .thing .content").hide(400),m=A,b=x)}):jQuery("body").on("click",function(e){!jQuery(e.target).hasClass("facebook-messenger-avatar")&&jQuery(".drag-wrapper .thing .content:visible").length&&(jQuery(".drag-wrapper .thing").removeClass("showContent"),jQuery(".drag-wrapper .thing .content").hide(400),m=A,b=x)});for(var y=0,c=["ms","moz","webkit","o"],m=0;m<c.length&&!window.requestAnimationFrame;++m)window.requestAnimationFrame=window[c[m]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c[m]+"CancelAnimationFrame"]||window[c[m]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var r=(new Date).getTime(),n=Math.max(0,16-(r-y)),a=window.setTimeout(function(){e(r+n)},n);return y=r+n,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});var v,j,Q=new rebound.SpringSystem,f=Q.createSpring(100,7.5),C=Q.createSpring(450,13),m=jQuery("body").width()-60,b="top"==l?w:"bottom"==l?jQuery(window).height()-60-w:jQuery(window).height()/2+10,A=0,x=0,F=[];f.setCurrentValue(1).setAtRest(),C.setCurrentValue(1).setAtRest(),jQuery(d).on("movestart",function(e){var t=jQuery(e.target),r=!0;if(jQuery(".drag-wrapper .thing").hasClass("showContent")&&(t.hasClass("circle")||t.parents(".circle").length?(jQuery(".drag-wrapper .thing").removeClass("showContent"),jQuery(".drag-wrapper .thing .content").hide(400),m=A,b=x):r=!1),r){var n=this.getBoundingClientRect();s(),this._touchOrigin={x:e.pageX,y:e.pageY},this._posOrigin={x:n.left,y:n.top}}}).on("move",function(e){F.length>5&&F.pop(),F.push(e)}).on("move",function(e){var r=jQuery(e.target),n=!0;if(jQuery(".drag-wrapper .thing").hasClass("showContent")&&(r.hasClass("circle")||r.parents(".circle").length?(jQuery(".drag-wrapper .thing").removeClass("showContent"),jQuery(".drag-wrapper .thing .content").hide(400),m=A,b=x):n=!1),n){var i=d,o=p.getBoundingClientRect(),s=i.getBoundingClientRect();newX=this._posOrigin.x+e.pageX-this._touchOrigin.x,newY=this._posOrigin.y+e.pageY-this._touchOrigin.y,a(newX+s.width/2,newY+s.height/2),g();var u={top:newY,right:newX+s.width,bottom:newY+s.height,left:newX};if(overlapping=!(u.top>o.bottom||u.right<o.left||u.bottom<o.top||u.left>o.right),v=newX,j=newY,overlapping){var h=o.width/2+o.left,l=o.height/2+o.top;if(newX=h-s.width/2,newY=l-s.height/2,jQuery(i).hasClass("overlap")||(C.setVelocity(5).setEndValue(0),f.setCurrentValue(0).setAtRest(),t(25)),jQuery(p).toggleClass("overlap",!0),jQuery(i).toggleClass("overlap",!0),!Q.getIsIdle())return}else jQuery(i).hasClass("overlap")&&(f.setEndValue(1),C.setCurrentValue(1).setAtRest()),jQuery(p).removeClass("overlap"),jQuery(i).removeClass("overlap");m=newX,b=newY}}).on("moveend",function(e){if(jQuery(".drag-wrapper .thing").hasClass("showContent"));else{var t=jQuery(d),r=i();t.hasClass("overlap")?(o(),u(),jQuery(".drag-wrapper").remove()):(h(r),o(),u())}}).on("click",function(e){var t=jQuery(e.target);if(t.hasClass("content")||t.parents(".content").length);else{var r=jQuery(window).width();jQuery(".drag-wrapper .thing .content:visible").length?(m=A,b=x):(A=m,x=b,m=r-74,b=20),jQuery(".drag-wrapper .thing .content").toggle(400),jQuery(".drag-wrapper .thing").toggleClass("showContent"),jQuery(".drag-wrapper .thing .content").css({"max-height":jQuery(window).height()-116})}})});